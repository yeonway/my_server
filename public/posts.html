<!-- public/posts.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ê²Œì‹œíŒ</title>
  <link rel="stylesheet" href="css/posts.css">
  <link rel="stylesheet" href="css/topbar.css">
</head>
<body>
  <header class="site-topbar">
    <a href="/index.html" class="site-logo" aria-label="Dcout ë©”ì¸ìœ¼ë¡œ ì´ë™">
      <span class="logo-accent">DC</span>
      <span class="logo-divider" aria-hidden="true"></span>
      <span class="logo-rest">OUT</span>
    </a>
  </header>

  <h1>ê²Œì‹œíŒ</h1>

  <!-- ê¸€ì“°ê¸° í¼ -->
  <div id="postForm">
    <input type="text" id="titleInput" placeholder="ì œëª©" maxlength="50">
    <textarea id="contentInput" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." maxlength="1000"></textarea>
    
    <!-- ì´ë¯¸ì§€/íŒŒì¼ ì¶”ê°€ ë²„íŠ¼ (ìœ„ì¹˜ ë³€ê²½) -->
    <div class="image-upload-container">
      <div id="imagePreviewContainer"></div>
      <label for="imageUpload" class="image-upload-wrapper">
        <div id="uploadButton" class="image-upload-btn">
          <span class="upload-icon">ğŸ–¼ï¸</span>
          <span class="upload-text">ì´ë¯¸ì§€/íŒŒì¼ ì¶”ê°€</span>
        </div>
      </label>
      <input type="file" id="imageUpload" multiple accept="image/*, .pdf, .doc, .docx, .xls, .xlsx, .ppt, .pptx, .hwp, .zip" style="display: none;">
    </div>

    <button id="submitBtn">ê¸€ì“°ê¸°</button>
  </div>

  <!-- ê³µì§€ì‚¬í•­ ëª©ë¡ ì»¨í…Œì´ë„ˆ ì¶”ê°€ -->
  <div id="noticePosts"></div>
  <!-- ê²Œì‹œê¸€ ëª©ë¡ (ìœ„ë¡œ ì´ë™) -->
  <div id="posts"></div>

  <!-- ê²€ìƒ‰ ë° ì»¨íŠ¸ë¡¤ ì˜ì—­ (ì•„ë˜ë¡œ ì´ë™) -->
  <div id="controlsContainer">
    <div class="search-container">
      <select id="searchType">
        <option value="all">ì „ì²´</option>
        <option value="title">ì œëª©</option>
        <option value="content">ë‚´ìš©</option>
        <option value="user">ì‘ì„±ì</option>
      </select>
      <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
      <button id="searchBtn">ê²€ìƒ‰</button>
    </div>
    <div class="view-options">
      <select id="postsPerPage">
        <option value="10">10ê°œì”© ë³´ê¸°</option>
        <option value="20">20ê°œì”© ë³´ê¸°</option>
        <option value="30">30ê°œì”© ë³´ê¸°</option>
        <option value="40">40ê°œì”© ë³´ê¸°</option>
        <option value="50">50ê°œì”© ë³´ê¸°</option>
      </select>
    </div>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ (ì•„ë˜ë¡œ ì´ë™) -->
  <div id="pagination"></div>

  <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
  <div id="imageModal" class="image-modal">
    <span class="image-modal-close">&times;</span>
    <img id="modalImage" class="image-modal-content" src="" alt="í™•ëŒ€ ì´ë¯¸ì§€">
  </div>

  <!-- ì•Œë¦¼ íŒì—… -->
  <div id="notification" class="notification-popup"></div>

  <!-- í™•ì¸ íŒì—… -->
  <div id="confirmModal" class="confirm-modal-overlay">
    <div class="confirm-modal">
      <p id="confirmMessage"></p>
      <div class="confirm-buttons">
        <button id="confirmYes">ì˜ˆ</button>
        <button id="confirmNo">ì•„ë‹ˆì˜¤</button>
      </div>
    </div>
  </div>

  <script>
    // --- ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜ ---
    let currentPage = 1;
    let postsPerPage = 10;
    let currentSearchQuery = '';
    let currentSearchType = 'all';
    let blockedUserIds = new Set();

    // --- DOM ìš”ì†Œ ---
    const token = localStorage.getItem("token");
    if (!token) {
      alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì„¸ìš”!");
      window.location.href = "login.html";
    }
    
    const postsDiv = document.getElementById("posts");
    const noticePostsDiv = document.getElementById("noticePosts"); // ê³µì§€ì‚¬í•­ div
    const searchInput = document.getElementById('searchInput');
    const searchTypeSelect = document.getElementById('searchType');
    const searchBtn = document.getElementById('searchBtn');
    const postsPerPageSelect = document.getElementById('postsPerPage');
    const paginationDiv = document.getElementById('pagination');
    const submitBtn = document.getElementById('submitBtn');
    const titleInput = document.getElementById('titleInput');
    const contentInput = document.getElementById('contentInput');

    async function loadBlockedUsers() {
      try {
        const response = await fetch('/api/users/blocks', {
          method: 'GET',
          headers: { 'Authorization': 'Bearer ' + token },
          credentials: 'same-origin'
        });

        const payload = await response.json().catch(() => ({}));
        if (!response.ok) {
          throw new Error(payload?.error || 'ì°¨ë‹¨ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
        }

        const blocks = Array.isArray(payload.blocks) ? payload.blocks : [];
        blockedUserIds = new Set(blocks.map((block) => block.id));
      } catch (error) {
        console.warn('[posts] loadBlockedUsers failed', error);
        blockedUserIds = blockedUserIds || new Set();
      }
    }

    // --- ë°ì´í„° ë¡œë”© ë° ë Œë”ë§ (ìˆ˜ì •) ---
    async function loadPosts() {
      postsDiv.innerHTML = "ë¡œë”© ì¤‘...";
      noticePostsDiv.innerHTML = ""; // ê³µì§€ì‚¬í•­ ì´ˆê¸°í™”
      try {
        const url = `/api/posts?page=${currentPage}&limit=${postsPerPage}&searchQuery=${encodeURIComponent(currentSearchQuery)}&searchType=${currentSearchType}`;
        const res = await fetch(url, { headers: { "Authorization": "Bearer " + token } });

        if (res.status === 401) {
          showNotification("ë¡œê·¸ì¸ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.", "error");
          setTimeout(() => window.location.href = "login.html", 2000);
          return;
        }

        const data = await res.json();
        postsDiv.innerHTML = "";

        // ê³µì§€ì‚¬í•­ ë Œë”ë§
        if (data.notices && data.notices.length > 0) {
          data.notices.forEach(post => renderPost(post, true));
        }

        // ì¼ë°˜ ê²Œì‹œê¸€ ë Œë”ë§
        if (data.posts && data.posts.length > 0) {
          data.posts.forEach(post => renderPost(post, false));
        } else if (data.notices.length === 0) {
          postsDiv.innerHTML = "<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        }
        renderPagination(data.totalPages, data.currentPage);

      } catch (err) {
        console.error("ê²Œì‹œê¸€ ë¡œë”© ì˜¤ë¥˜:", err);
        showNotification("ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
      }
    }

    function renderPagination(totalPages, currentPage) {
      paginationDiv.innerHTML = '';
      if (totalPages <= 1) return;

      const createPageButton = (page, text = page) => {
        const btn = document.createElement('button');
        btn.textContent = text;
        btn.className = 'page-number';
        if (page === currentPage) {
          btn.classList.add('active');
        }
        btn.onclick = () => {
          if (page !== '...') {
            currentPage = page;
            loadPosts();
          }
        };
        return btn;
      };

      // ì´ì „ ë²„íŠ¼
      const prevBtn = createPageButton(currentPage - 1, 'ì´ì „');
      prevBtn.disabled = currentPage === 1;
      paginationDiv.appendChild(prevBtn);

      const pageNumbers = [];
      if (totalPages <= 7) {
        for (let i = 1; i <= totalPages; i++) {
          pageNumbers.push(i);
        }
      } else {
        pageNumbers.push(1);
        if (currentPage > 3) pageNumbers.push('...');
        
        let start = Math.max(2, currentPage - 1);
        let end = Math.min(totalPages - 1, currentPage + 1);

        if (currentPage <= 3) {
          start = 2;
          end = 4;
        }
        if (currentPage >= totalPages - 2) {
          start = totalPages - 3;
          end = totalPages - 1;
        }

        for (let i = start; i <= end; i++) {
          pageNumbers.push(i);
        }

        if (currentPage < totalPages - 2) pageNumbers.push('...');
        pageNumbers.push(totalPages);
      }

      pageNumbers.forEach(num => {
        paginationDiv.appendChild(createPageButton(num));
      });

      // ë‹¤ìŒ ë²„íŠ¼
      const nextBtn = createPageButton(currentPage + 1, 'ë‹¤ìŒ');
      nextBtn.disabled = currentPage === totalPages;
      paginationDiv.appendChild(nextBtn);
    }

    // --- ê²Œì‹œê¸€ ë Œë”ë§ í•¨ìˆ˜ (ìˆ˜ì •) ---
    function renderPost(post, isNotice) {
      const div = document.createElement("div");
      div.className = "post-box";
      if (isNotice) {
        div.classList.add("notice");
      }
      div.dataset.id = post._id;

      // post.authorê°€ nullì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ì•ˆì „í•˜ê²Œ photo ê°’ì„ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
      const userPhoto = (post.author && post.author.photo) ? post.author.photo : "";
      const attachmentIcon = (post.images && post.images.length > 0) ? ' ğŸ“' : '';
      const noticeBadge = isNotice ? '<span style="color:var(--primary-color); font-weight:bold;">[ê³µì§€]</span> ' : '';
      
      div.innerHTML = `
        <div class="post-meta">
          ${getProfileImg(userPhoto)}
          <span class="post-username">${post.user}</span>
          <span class="post-date">${new Date(post.time).toLocaleDateString()}</span>
        </div>
        <div class="post-title">${noticeBadge}${post.title}${attachmentIcon}</div>
        <div class="post-content-preview">${post.content}</div>
      `;

      const authorRef = post?.author && typeof post.author === 'object' ? (post.author._id || post.author.id) : post?.author;
      const authorId = authorRef ? String(authorRef) : null;
      const me = parseJwt(token)?.username;

      if (authorId && post.user !== me) {
        const metaRow = div.querySelector('.post-meta');
        if (metaRow) {
          const blockWrapper = document.createElement('div');
          blockWrapper.className = 'post-meta-actions';
          const blockBtn = document.createElement('button');
          blockBtn.type = 'button';
          blockBtn.className = 'block-user-btn';
          const isBlocked = blockedUserIds.has(authorId);
          blockBtn.textContent = isBlocked ? 'ì°¨ë‹¨ í•´ì œ' : 'ì°¨ë‹¨';
          blockBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            toggleBlockUser(authorId, post.user, !isBlocked);
          });
          blockWrapper.appendChild(blockBtn);
          metaRow.appendChild(blockWrapper);
        }
      }


      if (post.user === me) {
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'post-actions';
        actionsDiv.innerHTML = `<button class="edit-btn">ìˆ˜ì •</button><button class="delete-btn">ì‚­ì œ</button>`;
        div.appendChild(actionsDiv);
      }
      
      // ê³µì§€ì‚¬í•­ì€ noticePostsDivì—, ì¼ë°˜ê¸€ì€ postsDivì— ì¶”ê°€
      if (isNotice) {
        noticePostsDiv.appendChild(div);
      } else {
        postsDiv.appendChild(div);
      }
    }

    async function toggleBlockUser(userId, username = '', shouldBlock) {
      if (!userId) return;
      const targetId = String(userId);
      const desiredBlock = typeof shouldBlock === 'boolean' ? shouldBlock : !blockedUserIds.has(targetId);
      try {
        let response;
        if (desiredBlock) {
          response = await fetch('/api/users/blocks', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + token
            },
            credentials: 'same-origin',
            body: JSON.stringify({ userId: targetId })
          });
        } else {
          response = await fetch(`/api/users/blocks/${targetId}`, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token },
            credentials: 'same-origin'
          });
        }

        const payload = await response.json().catch(() => ({}));
        if (!response.ok) {
          throw new Error(payload?.error || (desiredBlock ? 'ì‚¬ìš©ìë¥¼ ì°¨ë‹¨í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.' : 'ì°¨ë‹¨ì„ í•´ì œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'));
        }

        await loadBlockedUsers();
        await loadPosts();

        const label = username ? `${username}ë‹˜ì„ ` : '';
        showNotification(`${label}${desiredBlock ? 'ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.' : 'ì°¨ë‹¨ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤.'}`, 'success');
      } catch (error) {
        console.error('[posts] toggleBlockUser error', error);
        showNotification(error.message || 'ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    }

    // --- í™•ì¸ íŒì—…(ëª¨ë‹¬) í•¨ìˆ˜ ---
    function showConfirm(message) {
      return new Promise((resolve) => {
        const modal = document.getElementById('confirmModal');
        document.getElementById('confirmMessage').textContent = message;
        modal.classList.add('show');

        document.getElementById('confirmYes').onclick = () => {
          modal.classList.remove('show');
          resolve(true);
        };
        document.getElementById('confirmNo').onclick = () => {
          modal.classList.remove('show');
          resolve(false);
        };
      });
    }

    // --- ê²Œì‹œê¸€ ìˆ˜ì • ë° ì‚­ì œ ---
    async function deletePost(id) {
      const confirmed = await showConfirm("ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
      if (confirmed) {
        try {
          const res = await fetch(`/api/posts/${id}`, {
            method: "DELETE",
            headers: { "Authorization": "Bearer " + token }
          });
          if (res.ok) {
            loadPosts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          } else {
            alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (err) {
          alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    postsDiv.addEventListener('click', (e) => {
      if (e.target.classList.contains('delete-btn')) {
        const postBox = e.target.closest('.post-box');
        deletePost(postBox.dataset.id);
      } else if (e.target.classList.contains('edit-btn')) {
        // ìˆ˜ì • ê¸°ëŠ¥ì€ board.htmlë¡œ ì´ë™í•˜ì—¬ ì²˜ë¦¬
        const postBox = e.target.closest('.post-box');
        window.location.href = `board.html?id=${postBox.dataset.id}`;
      } else if (e.target.closest('.post-box')) {
        // ê²Œì‹œê¸€ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
        const postBox = e.target.closest('.post-box');
        window.location.href = `board.html?id=${postBox.dataset.id}`;
      }
    });

    // --- ê¸€ì“°ê¸° ë¡œì§ (ìˆ˜ì •) ---
    submitBtn.addEventListener('click', async () => {
      const title = titleInput.value.trim();
      const content = contentInput.value.trim();

      if (!title) {
        alert("ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        titleInput.focus();
        return;
      }
      if (!content) {
        alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        contentInput.focus();
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "ë“±ë¡ ì¤‘...";

      try {
        // 1. ì´ë¯¸ì§€/íŒŒì¼ ì—…ë¡œë“œ
        const imagePaths = [];
        for (const file of uploadedFiles) {
          const path = await handleFileUpload(file);
          if (path) {
            imagePaths.push(path);
          }
        }

        // 2. ê²Œì‹œê¸€ ë°ì´í„° ì „ì†¡
        const res = await fetch("/api/posts", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token,
          },
          body: JSON.stringify({ title, content, images: imagePaths }),
        });

        if (res.ok) {
          // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
          titleInput.value = "";
          contentInput.value = "";
          uploadedFiles = [];
          imagePreviewContainer.innerHTML = "";
          updateImagePreviewVisibility();
          
          // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ì´ë™
          loadPosts();
          alert("ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } else {
          const errorData = await res.json();
          alert(`ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorData.error}`);
        }
      } catch (err) {
        alert(`ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message}`);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "ê¸€ì“°ê¸°";
      }
    });
    
    // ê²€ìƒ‰, í˜ì´ì§€ë„¤ì´ì…˜ ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ê¸°ì¡´ê³¼ ë™ì¼
    searchInput.addEventListener('input', (e) => {
      if (e.target.value.trim() === '' && currentSearchQuery !== '') {
        currentSearchQuery = '';
        currentPage = 1;
        loadPosts();
      }
    });
    searchBtn.addEventListener('click', () => {
      currentPage = 1;
      currentSearchQuery = searchInput.value;
      currentSearchType = searchTypeSelect.value;
      loadPosts();
    });
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchBtn.click();
    });
    postsPerPageSelect.addEventListener('change', (e) => {
      currentPage = 1;
      postsPerPage = parseInt(e.target.value);
      loadPosts();
    });

    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
    function parseJwt(token) {
      try { return JSON.parse(atob(token.split('.')[1])); }
      catch (e) { return null; }
    }

    function getProfileImg(photo) {
      if (photo && photo !== "") {
        return `<img class="profile-thumb" src="${photo}" alt="í”„ë¡œí•„">`;
      } else {
        return `<span class="profile-thumb default">
          <svg width="26" height="26" viewBox="0 0 38 38"><circle cx="19" cy="19" r="19" fill="#e0e7ef"/><circle cx="19" cy="15" r="9" fill="#b6d0f7"/><ellipse cx="19" cy="30" rx="13" ry="7" fill="#b6d0f7"/><circle cx="19" cy="15" r="6" fill="#fff"/><ellipse cx="19" cy="30" rx="9" ry="4" fill="#fff"/></svg>
        </span>`;
      }
    }
    
    // --- ì´ë¯¸ì§€/íŒŒì¼ ì—…ë¡œë“œ ë° ë¯¸ë¦¬ë³´ê¸° ê´€ë ¨ í•¨ìˆ˜ë“¤ ---
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const imageUploadInput = document.getElementById('imageUpload');
    let uploadedFiles = [];

    function updateImagePreviewVisibility() {
      imagePreviewContainer.style.display = imagePreviewContainer.children.length > 0 ? 'grid' : 'none';
    }

    imageUploadInput.addEventListener('change', (event) => {
      const files = Array.from(event.target.files);
      files.forEach(file => {
        if (!uploadedFiles.some(f => f.name === file.name && f.size === file.size)) {
          uploadedFiles.push(file);
          addImagePreview(file);
        }
      });
      event.target.value = '';
    });

    function addImagePreview(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const previewDiv = document.createElement('div');
        previewDiv.className = 'image-preview';
        const isImage = file.type.startsWith('image/');
        previewDiv.innerHTML = `
          ${isImage ? `<img src="${e.target.result}" alt="${file.name}">` : `<div class="file-icon">ğŸ“„</div>`}
          <div class="image-preview-name">${file.name}</div>
          <button class="image-remove-btn">&times;</button>
        `;
        previewDiv.querySelector('.image-remove-btn').onclick = () => removeImage(file.name, file.size, previewDiv);
        imagePreviewContainer.appendChild(previewDiv);
        updateImagePreviewVisibility();
      };
      reader.readAsDataURL(file);
    }

    function removeImage(fileName, fileSize, previewElement) {
      uploadedFiles = uploadedFiles.filter(f => !(f.name === fileName && f.size === fileSize));
      previewElement.remove();
      updateImagePreviewVisibility();
    }

    // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ í•¨ìˆ˜ (ì¶”ê°€)
    async function handleFileUpload(file) {
      const formData = new FormData();
      formData.append('image', file);

      try {
        const res = await fetch('/api/posts/upload-image', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token },
          body: formData,
        });
        if (!res.ok) throw new Error('íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
        const data = await res.json();
        return data.imagePath;
      } catch (err) {
        console.error('Upload error:', err);
        alert(`${file.name} ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${err.message}`);
        return null;
      }
    }

    // --- ì´ˆê¸° ë¡œë“œ ---
    (async function initializeBoard() {
      await loadBlockedUsers();
      await loadPosts();
    })();
    
    // ì•Œë¦¼ í‘œì‹œ ê¸°ëŠ¥ (ëˆ„ë½ ë°©ì§€)
    function showNotification(message, type = "error") {
      const notification = document.getElementById("notification");
      notification.className = `notification-popup ${type}`;
      notification.innerHTML = `
        <button class="close-btn">&times;</button>
        <span class="notification-icon">${type === "error" ? "âŒ" : type === "success" ? "âœ…" : "âš ï¸"}</span>
        ${message}
      `;
      notification.classList.add("show");
      
      // ë‹«ê¸° ë²„íŠ¼
      const closeBtn = notification.querySelector(".close-btn");
      closeBtn.addEventListener("click", () => {
        notification.classList.remove("show");
      });
      
      // ìë™ ë‹«í˜
      setTimeout(() => {
        notification.classList.remove("show");
      }, 5000);
    }
  </script>
</body>
</html>
