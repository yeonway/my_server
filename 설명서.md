프로젝트 개요
------------
Node.js와 Express 기반 커뮤니티/관리자 서버입니다. MongoDB(Mongoose)로 사용자, 게시글, 채팅, 신고/문의 내역을 저장하며, Socket.IO로 실시간 채팅을 제공합니다. 관리자 페이지는 `public/`의 정적 자산으로 렌더링되며, REST API와 웹소켓이 혼합된 구조입니다.

사전 준비
--------
- Node.js 18 LTS 이상 및 npm
- MongoDB 서버 (`mongodb://localhost:27017/my_server`)
- `.env` 파일에 환경 변수 설정

주요 기능
--------
- **인증/권한**: 회원가입(브라우저당 최대 3회, 초과 시 경고 및 서버 로그 기록), 로그인, JWT 인증, 역할/퍼미션 분리, `admin` 계정은 항상 `superadmin` 유지
- **관리자 대시보드**: 통계, 시스템 설정, 백업/복원, 캐시 관리, 로그 열람, 차트 시각화
- **사용자 관리**: 검색/필터, 권한 및 등급 변경, 계정 비활성화·삭제, 통계 조회, IP/디바이스 차단
- **게시글 관리**: 목록/상세, 공지 지정(성공 시 초록색 표시), 수정/삭제, 작성일 표시, 게시글 백업
- **신고·문의 처리**: 신고 상태 변경 및 메모 작성, 문의 답변과 처리 이력 관리
- **콘텐츠 필터**: 금칙어 CRUD, 캐시 재생성, 게시글/메시지 필터링
- **파일 업로드**: 사용자·게시글·문의 첨부 파일 저장, 업로드 로그 기록
- **팔로우/소셜**: 팔로우/언팔로우, 팔로워/팔로잉 수 제공
- **채팅 시스템**: 개인·그룹 채팅, 읽음 표시, 입력 내용 임시 저장, 관리자 열람 기능
- **로깅/감사**: `requestId`, `username`, `action`, `path`, `ts` 등 공통 필드 포함 상세 로그

환경 변수
--------
`.env` 예시:
```
MONGO_URI=mongodb://localhost:27017/my_server
JWT_SECRET=e-3!0OE3icN,TYmG
CORS_ORIGINS=http://localhost:3000
```
- `MONGO_URI`: MongoDB 연결 문자열
- `JWT_SECRET`: JWT 서명용 비밀키
- `CORS_ORIGINS`: 허용할 CORS Origin(쉼표로 다중 지정 가능)
- 필요 시 `PORT`, `SITE_NAME`, `MAX_FILE_SIZE` 등 추가 환경 변수 설정 가능

실행 방법
--------
- 의존성 설치: `npm install`
- 개발 모드: `npx nodemon server.js`
- 프로덕션 실행: `npm start`
- 테스트: `npm test` (미구현 스텁)

서버 기동 후 기본 포트는 `3000`이며, `.env`의 `PORT` 값으로 변경 가능.  
정적 페이지는 `http://localhost:3000/admin.html` 등으로 접근.

디렉터리 구조
------------
my_server/
|-- .env
|-- package.json
|-- package-lock.json
|-- server.js
|-- config/
|   |-- db.js
|   |-- logger.js
|   |-- loginLock.js
|   |-- secrets.js
|   |-- security.js
|   |-- userLogger.js
|-- logs/
|   |-- app-YYYY-MM-DD.log
|   |-- users/
|       |-- admin/
|           |-- 2025-10-03.log
|       |-- superadmin/
|           |-- 2025-10-03.log
|-- middleware/
|   |-- auth.js
|   |-- contentFilter.js
|-- models/
|   |-- adminActivity.js
|   |-- backupPost.js
|   |-- chatroom.js
|   |-- comment.js
|   |-- forbiddenWord.js
|   |-- inquiry.js
|   |-- message.js
|   |-- post.js
|   |-- report.js
|   |-- statistic.js
|   |-- user.js
|-- public/
|   |-- admin.html
|   |-- board.html
|   |-- chat.html
|   |-- index.html
|   |-- inquiry.html
|   |-- login.html
|   |-- posts.html
|   |-- profile.html
|   |-- public.html
|   |-- search.html
|   |-- setting.html
|   |-- signup.html
|   |-- css/
|   |   |-- admin.css
|   |   |-- index.css
|   |   |-- setting.css
|   |-- js/
|   |   |-- admin.js
|   |   |-- main.js
|   |   |-- signupTracker.js
|   |-- fonts/
|-- routes/
|   |-- admin.js
|   |-- auth.js
|   |-- chat.js
|   |-- inquiry.js
|   |-- posts.js
|   |-- profile.js
|   |-- report.js
|   |-- setting.js
|   |-- users.js
|-- scripts/
|   |-- badwords.ko.config.json
|   |-- create_indexes.js
|   |-- dump_posts_backup.js
|   |-- import_badwords.js
|   |-- migrate_images_to_objects.js
|   |-- migrate_post_image_paths.js
|-- utils/
|   |-- scheduler.js
|-- 설명서.md

주요 라우터 요약
----------------
- `routes/auth.js`: 회원가입/로그인/로그아웃, admin 계정 보호
- `routes/users.js`: 사용자 관리, 차단(IP·브라우저)
- `routes/posts.js`: 게시글 CRUD, 공지 토글, 검색/필터
- `routes/admin.js`: 대시보드, 시스템 설정, 로그, 백업, 통계, 권한 관리
- `routes/report.js`, `routes/inquiry.js`: 신고/문의 처리
- `routes/chat.js`: 채팅방, 메시지 기록, 팔로우 기능 연동
- `routes/profile.js`, `routes/setting.js`: 개인 설정, 알림, 팔로우

데이터 모델 하이라이트
---------------------
- `models/user.js`: 사용자 정보, 역할/권한, 차단 정보
- `models/post.js`: 게시글, 카테고리, 공지 여부, 작성자
- `models/report.js`, `models/inquiry.js`: 신고/문의 상태, 담당 관리자, 처리 시각
- `models/chatroom.js`, `models/message.js`: 채팅방 및 메시지 로그
- `models/adminActivity.js`: 관리자 작업 이력
- `models/forbiddenWord.js`: 금칙어와 심각도

로그 및 감사 정책
----------------
- `config/logger.js`: Winston 기반 애플리케이션 로그(일별 로테이션)
- `config/userLogger.js`: 사용자별 감사 로그를 `logs/users/{username}`에 저장
- 각 API 라우터에서 공통 필드 포함 로그 기록
- 인증되지 않은 요청은 `username: "anonymous"`로 기록

유지보수 스크립트
----------------
- `scripts/create_indexes.js`: MongoDB 인덱스 생성
- `scripts/dump_posts_backup.js`: 게시글 백업 JSON 생성
- `scripts/import_badwords.js`: 금칙어 일괄 등록
- `scripts/migrate_*`: 이미지 경로·객체 마이그레이션 도구

개발 팁 및 주의사항
------------------
- 관리자 페이지 수정 시 `public/js/admin.js`, `public/admin.html`, `routes/admin.js`를 함께 점검
- Socket.IO 토큰 인증은 `server.js`에서 처리
- IP/브라우저 차단은 로그인 시 검사
- MongoDB 컬렉션 구조 변경 시 인덱스 및 모델 스키마 업데이트 후 서버 재기동 권장
- 로그 파일이 커질 수 있으니 `logs/` 디렉터리 주기적 정리

회원가입 제한 정책
------------------
- 한 브라우저에서 **최대 3회까지 회원가입 가능**
- 3회 초과 시 클라이언트에 경고 표시 및 서버 로그(`logger.warn`)로 기록
- 관리자 페이지에서 해당 로그를 열람 가능

문의
----
운영 중 이슈나 문서 보완 사항은 `config/logger.js`의 로깅 포맷을 참고해 재현 로그를 확보한 뒤 공유하면 빠른 분석이 가능합니다.